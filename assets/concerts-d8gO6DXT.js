import{j as M,M as l,bb as C,L as c,af as F,ac as T,ao as b,ae as p}from"./index-iKGXzdRM.js";import{h as g}from"./moment-WSJ9un1t.js";const k=()=>{let t;const e=M(null);return{state:t,err:e,timeCountryFilter:async(o,a="",r="",d="",y=1)=>{const u=a==="本日"?"day":a==="本週"?"week":"month",A=g().startOf(u).format("YYYY-MM-DD"),v=g().endOf(u).format("YYYY-MM-DD");let m=(o==="front"?l.concerts:C.concerts)+"?";const $=`start=${A}&end=${v}`,P=`country=${r}`,Y=`q=${d}`,S=`page=${y}`,i=[];return d!==""&&i.push(Y),r!==""&&i.push(P),a!==""&&i.push($),i.push(S),m+=i.join("&"),new Promise((x,D)=>{c.get(m).then(h=>{t=h.data,x(t)}).catch(h=>{console.error(h),e.value=h,D(e)})})}}},{timeCountryFilter:f}=k(),{getUserSavedAndFollowed:w}=F(),{setIsLoading:s}=T(),U=b("concerts",{state:()=>({concerts:[],adminConcerts:[],singleConcert:{},pagination:{},timeFactor:"",countryFactor:"",textFactor:"",pageFactor:""}),actions:{searchConcerts:p(function(t){this.textFactor=t,this.getFilterConcerts()},300),searchAdminConcerts:p(function(t){this.textFactor=t,this.getAdminConcerts()},300),getAllConcerts(){s(),c.get(l.concerts).then(t=>{this.concerts=t.data.data,this.pagination=t.data.pagination}).catch(t=>{console.error(t)}).finally(()=>{s()})},getFilterConcerts(t,e,n=1){t==="time"&&(e==="all"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="all"?this.countryFactor="":this.countryFactor=e),this.pageFactor=n,f("front",this.timeFactor,this.countryFactor,this.textFactor,this.pageFactor).then(o=>{this.concerts=o.data,this.pagination=o.pagination})},getSingleConcert(t){s(),c.get(`${l.concerts}/${t}`).then(e=>{this.singleConcert=e.data.data}).catch(e=>{console.error(e)}).finally(()=>{s()})},getAllAdminConcerts(){s(),c.get(C.concerts).then(t=>{this.adminConcerts=t.data.data,this.pagination=t.data.pagination}).catch(t=>{console.error(t)}).finally(()=>{s()})},getFilterAdminConcerts(t,e,n=1){t==="time"&&(e==="全部"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="全部"?this.countryFactor="":this.countryFactor=e),this.pageFactor=n,f("admin",this.timeFactor,this.countryFactor,this.textFactor,this.pageFactor).then(o=>{this.adminConcerts=[...o.data].sort((a,r)=>r.id-a.id),this.pagination=o.pagination})},saveConcertAction(t,e){c[t](`${l.concerts}/${e}/${t==="post"?"save":"unsave"}`).then(n=>{}).then(()=>{w()}).catch(n=>{console.error(n)})},callSaveAction(t){const{savedConcerts:e,AccessToken:n}=F();n!==void 0&&([...e].some(o=>o.id===t)?this.saveConcertAction("delete",t):this.saveConcertAction("post",t))}}});export{U as u};
