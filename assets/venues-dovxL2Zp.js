import{a5 as l,aq as p,M as n,N as o,a7 as h,b6 as i,b4 as m}from"./index-duMluzMb.js";const{setIsLoading:s}=l(),V=p("venues",{state:()=>({venueInfo:[],venues:[],venue:{},pagination:{},seatArea:"",searchText:"",city:"",searchPage:1,adminVenues:[],adminSearchText:"",adminCity:"",adminCityOptions:"",imageUrl:[],isModalOpen:!1,isNew:!1,tempAdminVenue:{title:"",eng_title:"",address:"",city:"",picture:{horizontal:"",square:""},map_link:"",seat_picture:"",seat_areas:[],seat_amount:0,transportation:[{type:"",info:""}]}}),actions:{getVenueInfo(){n.get(`${o.venues}?comments=1`).then(e=>{this.venueInfo=e.data.data}).catch(e=>{console.error(e)})},getVenues(e=1){s(),n.get(`${o.venues}?page=${e}`).then(t=>{window.scroll(0,0),this.venues=t.data.data,this.pagination=t.data.pagination}).catch(t=>{console.error(t)}).finally(()=>{s()})},getVenuesByCity(e){this.city=e,this.page=1,s(),this.searchVenues(this.searchText,1),setTimeout(()=>{s()},500)},getVenuesByPage(e){s(),this.searchVenues(this.searchText,e),setTimeout(()=>{s()},600)},getVenue(e){s(),n.get(`${o.venues}/${e}`).then(t=>{this.venue=t.data.data}).catch(t=>{console.error(t)}).finally(()=>{setTimeout(()=>{s()},100)})},searchVenues:h(function(e,t=1){this.searchText=e,this.searchPage=t,n.get(`${o.venues}/?q=${e}&city=${this.city}&page=${t}`).then(a=>{this.venues=a.data.data,this.pagination=a.data.pagination}).catch(a=>{console.error(a)})},300),resetState(){this.searchText="",this.city="",this.searchPage=1},reportUser(e){i({title:`已檢舉該使用者${e}`,description:""})},getAdminVenues:h(async function(){const{adminSearchText:e,adminCity:t}=this,a={q:e||"",city:t&&t!=="全部"?t:"",page:1},r=new URLSearchParams(a).toString(),u=`${m.venues}?${r}`;s();try{const c=await n.get(u);this.adminVenues=c.data.data,this.adminCityOptions=[...new Set(c.data.data.map(d=>d.city))]}catch{i({title:"無法取得會員列表"})}finally{s()}},150),getAdminSingleVenue(e){n.get(`${o.venues}/${e}`).then(t=>{this.tempAdminVenue=t.data.data;const{picture:a}=this.tempAdminVenue;this.imageUrl=[a.horizontal,a.square,this.tempAdminVenue.seat_picture],delete this.tempAdminVenue.picture.horizontal,delete this.tempAdminVenue.picture.square,delete this.tempAdminVenue.seat_picture}).catch(t=>{console.error(t)})},deleteVenue(e,t){if(!e)return;const a=[1,2,3,4,5,6],r={_method:"DELETE"};if(t==="multiple"){if(e.some(u=>a.includes(u))){i({title:"重要的場地不允許刪除"});return}r.ids=e}else if(t==="single"){if(e<=6){i({title:"重要的場地不允許刪除"});return}r.ids=[e]}n.post(m.venues,r).then(()=>{i({title:"刪除成功"}),this.getAdminVenues()}).catch(()=>{i({title:"刪除失敗"})})}},getters:{filterSeatComment(){return this.seatArea==="all"||this.seatArea===""?this.venue.comments:this.venue.comments.filter(e=>e.seat_area===this.seatArea)},transportation(){var e;return(e=this.venue.transportation)==null?void 0:e.map((t,a)=>({...t,value:`item-${a+1}`}))}}});export{V as u};
