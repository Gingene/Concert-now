import{j as D,aA as r,ba as M,az as h,ac as C,a9 as T,al as b,ab as p}from"./index-Nwj6HwkL.js";import{h as d}from"./moment-WSJ9un1t.js";const k=()=>{let t;const e=D(null);return{state:t,err:e,timeCountryFilter:async(s,n="",i="",l="",F=1)=>{const u=n==="本日"?"day":n==="本週"?"week":"month",y=d().startOf(u).format("YYYY-MM-DD"),v=d().endOf(u).format("YYYY-MM-DD");let m=(s==="front"?r.concerts:M.concerts)+"?";const A=`start=${y}&end=${v}`,$=`country=${i}`,P=`q=${l}`,Y=`page=${F}`,c=[];return l!==""&&c.push(P),i!==""&&c.push($),n!==""&&c.push(A),c.push(Y),m+=c.join("&"),new Promise((S,x)=>{h.get(m).then(a=>{t=a.data,S(t)}).catch(a=>{console.log(a),e.value=a,x(e)})})}}},{timeCountryFilter:g}=k(),{getUserSavedAndFollowed:w}=C(),{setIsLoading:f}=T(),z=b("concerts",{state:()=>({concerts:[],singleConcert:{},pagination:{},timeFactor:"",countryFactor:"",textFactor:"",pageFactor:""}),actions:{searchConcerts:p(function(t){this.textFactor=t,this.getConcerts()},300),searchAdminConcerts:p(function(t){this.textFactor=t,this.getAdminConcerts()},300),getConcerts(t,e,o=1){t==="time"&&(e==="all"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="all"?this.countryFactor="":this.countryFactor=e),this.pageFactor=o,g("front",this.timeFactor,this.countryFactor,this.textFactor,this.pageFactor).then(s=>{this.concerts=s.data,this.pagination=s.pagination})},getSingleConcert(t){f(),h.get(`${r.concerts}/${t}`).then(e=>{this.singleConcert=e.data.data}).catch(e=>{console.log(e)}).finally(()=>{f()})},getAdminConcerts(t,e,o=1){t==="time"&&(e==="全部"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="全部"?this.countryFactor="":this.countryFactor=e),this.pageFactor=o,g("admin",this.timeFactor,this.countryFactor,this.textFactor,this.pageFactor).then(s=>{this.concerts=[...s.data].sort((n,i)=>i.id-n.id),this.pagination=s.pagination})},saveConcertAction(t,e){h[t](`${r.concerts}/${e}/${t==="post"?"save":"unsave"}`).then(o=>{console.log(o)}).then(()=>{w()}).catch(o=>{console.log(o)})},callSaveAction(t){const{savedConcerts:e,AccessToken:o}=C();o!==void 0&&([...e].some(s=>s.id===t)?this.saveConcertAction("delete",t):this.saveConcertAction("post",t))}}});export{z as u};
