import{j as Y,aq as a,ap as r,ac as f,a9 as D,al as x,ab as T}from"./index-q7oUn2GA.js";import{h as p}from"./moment-WSJ9un1t.js";import{u as U}from"./useDarkAlert--DkJa6xP.js";const k=()=>{let t;const e=Y(null);return{state:t,err:e,timeCountryFilter:async(n,i="",h="",l="",d=1)=>{const u=i==="本日"?"day":i==="本週"?"week":"month",C=p().startOf(u).format("YYYY-MM-DD"),v=p().endOf(u).format("YYYY-MM-DD");let g=(n==="concerts"?a.concerts:a.artists)+"?";const y=`start=${C}&end=${v}`,F=`country=${h}`,S=`q=${l}`,$=`page=${d}`,s=[];return l!==""&&s.push(S),h!==""&&s.push(F),i!==""&&s.push(y),s.push($),g+=s.join("&"),new Promise((w,P)=>{r.get(g).then(c=>{console.log(c),t=c.data,w(t)}).catch(c=>{console.log(c),e.value=c,P(e)})})}}},{timeCountryFilter:A}=k(),{getUserSavedAndFollowed:M}=f(),{swalWithStylingButtons:b}=U(),{setIsLoading:m}=D(),I=x("concerts",{state:()=>({concerts:[],singleConcert:{},pagination:{},timeFactor:"",countryFactor:"",textFactor:"",pageFactor:""}),actions:{searchConcerts:T(function(t){this.textFactor=t,this.getConcerts()},300),getConcerts(t,e,o=1){t==="time"&&(e==="all"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="all"?this.countryFactor="":this.countryFactor=e),this.pageFactor=o,A("concerts",this.timeFactor,this.countryFactor,this.textFactor,this.pageFactor).then(n=>{this.concerts=n.data,this.pagination=n.pagination}).then(()=>{})},getSingleConcert(t){m(),r.get(`${a.concerts}/${t}`).then(e=>{this.singleConcert=e.data.data}).then(()=>{m()}).catch(e=>{console.log(e)})},saveUnSavedConcert(t,e){r[t](`${a.concerts}/${e}/${t==="post"?"save":"unsave"}`).then(o=>{console.log(o)}).then(()=>{M()}).catch(o=>{console.log(o)})},callSaveAction(t){const{savedConcerts:e,AccessToken:o}=f();if(o===void 0){b.fire({title:"登入後才能用收藏功能喔！",showCancelButton:!0,confirmButtonText:"前往登入"}).then(n=>{n.isConfirmed&&(window.location.href="https://gingene.github.io/Concert-now/#/login")});return}[...e].some(n=>n.id===t)?this.saveUnSavedConcert("delete",t):this.saveUnSavedConcert("post",t)}}});export{I as u};
