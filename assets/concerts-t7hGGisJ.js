import{i as $,N as m,b4 as F,M as r,a8 as C,a5 as v,K as D,aq as N,a7 as u}from"./index-duMluzMb.js";import{h as p}from"./moment-WSJ9un1t.js";const x=()=>{let t;const e=$(null);return{state:t,err:e,timeCountryFilter:async(i,n="",c="",l="",y=1)=>{const d=n==="本日"?"day":n==="本週"?"week":"month",T=p().startOf(d).format("YYYY-MM-DD"),A=p().endOf(d).format("YYYY-MM-DD");let g=(i==="front"?m.concerts:F.concerts)+"?";const P=`start=${T}&end=${A}`,S=`country=${c}`,w=`q=${l}`,E=`page=${y}`,a=[];return l!==""&&a.push(w),c!==""&&a.push(S),n!==""&&a.push(P),a.push(E),g+=a.join("&"),new Promise((O,Y)=>{r.get(g).then(h=>{t=h.data,O(t)}).catch(h=>{console.error(h),e.value=h,Y(e)})})}}},{timeCountryFilter:f}=x(),{getUserSavedAndFollowed:k}=C(),{setIsLoading:o}=v(),{toast:I}=D(),j=N("concerts",{state:()=>({concerts:[],selectedConcerts:[{id:10,show:"false",name:"King Gnu Asia Tour『THE GREATEST UNKNOWN』in Taipei",date:"2024-04-06 (六) 19:00",image:"https://i.imgur.com/ZbzHz0X.jpg"},{id:7,show:"false",name:"原子邦妮「明明早點放棄就沒事了」",date:"2024-04-20 (六) 19:30",image:"https://i.imgur.com/CDtPlHG.png"},{id:4,show:"true",name:"理想混蛋【奇異點 BESTRANGE】演唱會 高雄場",date:"2024-01-27 (六) 19:00",image:"https://i.imgur.com/kPcCvf8.jpg"},{id:5,show:"false",name:"溫蒂漫步 Wendy Wander 2024 Tour “Midnight Wandering 午夜漫遊“",date:"2024-01-27 (六) 19:00",image:"https://i.imgur.com/FlEOLfm.jpg"},{id:6,show:"false",name:"YOASOBI演唱會2024台北站",date:"2024-01-21 (日) 19:00",image:"https://i.imgur.com/E6JbF0S.jpg"},{id:3,show:"false",name:"FTISLAND演唱會2024台北站",date:"2024-02-18 (六) 17:00",image:"https://i.imgur.com/2VtzkiT.png"},{id:12,show:"false",name:"ITZY 2ND WORLD TOUR <BORN TO BE> in TAIPEI",date:"2024-07-20 (六) 18:00",image:"https://i.imgur.com/GWg5REN.png"},{id:11,show:"false",name:"宇宙人《α：回到未來》20週年演唱會",date:"2024-04-27 (六) 19:30",image:"https://i.imgur.com/TkXaaeF.png"}],adminConcerts:[],singleConcert:{},pagination:{},timeFactor:"",countryFactor:"",textFactor:"",pageFactor:1}),actions:{searchConcerts:u(function(t){this.textFactor=t,this.getFilterFrontConcerts()},300),searchAdminConcerts:u(function(t){this.textFactor=t,this.getFilterAdminConcerts()},300),getAllConcerts(){this.timeFactor="",this.countryFactor="",this.textFactor="",o(),r.get(m.concerts).then(t=>{this.concerts=t.data.data,this.pagination=t.data.pagination}).catch(t=>{console.error(t)}).finally(()=>{o()})},getFilterFrontConcerts(t,e,s=1){t==="time"&&(e==="all"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="all"?this.countryFactor="":this.countryFactor=e),this.pageFactor=s,f("front",this.timeFactor,this.countryFactor,this.textFactor,s).then(i=>{this.concerts=i.data,this.pagination=i.pagination})},getSingleConcert(t,e=null){o(),r.get(`${m.concerts}/${t}`).then(s=>{this.singleConcert=s.data.data,e&&e()}).catch(s=>{console.error(s)}).finally(()=>{o()})},callSaveAction(t){const{savedConcerts:e,AccessToken:s}=C();if(s===void 0)return;let i="";[...e].some(n=>n.id===t)?i="delete":i="post",r[i](`${m.concerts}/${t}/${i==="post"?"save":"unsave"}`).then(n=>{}).then(()=>{k(i),I({title:i==="post"?"已加入收藏":"已取消收藏"})}).catch(n=>{console.error(n)})},getAllAdminConcerts(){o(),r.get(F.concerts).then(t=>{this.adminConcerts=t.data.data.reverse(),this.pagination=t.data.pagination}).catch(t=>{console.error(t)}).finally(()=>{o()})},getFilterAdminConcerts(t,e,s=1){t==="time"&&(e==="全部"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="全部"?this.countryFactor="":this.countryFactor=e),this.pageFactor=s,f("admin",this.timeFactor,this.countryFactor,this.textFactor,this.pageFactor).then(i=>{this.adminConcerts=[...i.data].sort((n,c)=>c.id-n.id),this.pagination=i.pagination})}}});export{j as u};
