import{j as D,ab as r,bb as T,aa as h,af as C,ac as b,a9 as M,ao as k,ae as p}from"./index-8EEsLggX.js";import{h as d}from"./moment-WSJ9un1t.js";const w=()=>{let t;const e=D(null);return{state:t,err:e,timeCountryFilter:async(s,n="",c="",u="",F=1)=>{const l=n==="本日"?"day":n==="本週"?"week":"month",y=d().startOf(l).format("YYYY-MM-DD"),v=d().endOf(l).format("YYYY-MM-DD");let m=(s==="front"?r.concerts:T.concerts)+"?";const $=`start=${y}&end=${v}`,A=`country=${c}`,P=`q=${u}`,Y=`page=${F}`,a=[];return u!==""&&a.push(P),c!==""&&a.push(A),n!==""&&a.push($),a.push(Y),m+=a.join("&"),new Promise((S,x)=>{h.get(m).then(i=>{t=i.data,S(t)}).catch(i=>{console.log(i),e.value=i,x(e)})})}}},{timeCountryFilter:f}=w(),{getUserSavedAndFollowed:j}=C(),{setIsLoading:g}=b(),{toast:O}=M(),z=k("concerts",{state:()=>({concerts:[],adminConcerts:[],singleConcert:{},pagination:{},timeFactor:"",countryFactor:"",textFactor:"",pageFactor:""}),actions:{searchConcerts:p(function(t){this.textFactor=t,this.getConcerts()},300),searchAdminConcerts:p(function(t){this.textFactor=t,this.getAdminConcerts()},300),getConcerts(t,e,o=1){t==="time"&&(e==="all"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="all"?this.countryFactor="":this.countryFactor=e),this.pageFactor=o,f("front",this.timeFactor,this.countryFactor,this.textFactor,this.pageFactor).then(s=>{this.concerts=s.data,this.pagination=s.pagination})},getSingleConcert(t){g(),h.get(`${r.concerts}/${t}`).then(e=>{this.singleConcert=e.data.data}).catch(e=>{console.error(e)}).finally(()=>{g()})},getAdminConcerts(t,e,o=1){t==="time"&&(e==="全部"?this.timeFactor="":this.timeFactor=e),t==="country"&&(e==="全部"?this.countryFactor="":this.countryFactor=e),this.pageFactor=o,f("admin",this.timeFactor,this.countryFactor,this.textFactor,this.pageFactor).then(s=>{this.adminConcerts=[...s.data].sort((n,c)=>c.id-n.id),this.pagination=s.pagination})},saveConcertAction(t,e){h[t](`${r.concerts}/${e}/${t==="post"?"save":"unsave"}`).then(o=>{}).then(()=>{j(),O({title:t==="post"?"已加入收藏":"已取消收藏"})}).catch(o=>{console.error(o)})},callSaveAction(t){const{savedConcerts:e,AccessToken:o}=C();o!==void 0&&([...e].some(s=>s.id===t)?this.saveConcertAction("delete",t):this.saveConcertAction("post",t))}}});export{z as u};
